CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `partner_id` tinyint(3) unsigned NOT NULL,
  `external_id` varchar(32) NOT NULL,
  `date_created` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `date_modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `name` varchar(128) DEFAULT NULL,
  `email` varchar(254) DEFAULT NULL,
  `stripe_customer_id` varchar(128) DEFAULT NULL,
  `telephone` varchar(16) DEFAULT NULL,
  `has_seen_onboarding` tinyint(1) NOT NULL DEFAULT '0',
  `has_seen_qualification` tinyint(1) NOT NULL DEFAULT '0',
  `qualify_state` varchar(2) DEFAULT NULL,
  `qualify_last_exam_date` date DEFAULT NULL,
  `qualify_birthday` date DEFAULT NULL,
  `is_staff` tinyint(1) NOT NULL DEFAULT '0',
  `env` varchar(32) DEFAULT 'prod',
  `sandbox` tinyint(1) NOT NULL DEFAULT '0',
  `referral_id` varchar(16) DEFAULT NULL,
  `attachments` json DEFAULT NULL,
  `labels` json DEFAULT NULL,
  `notes` text,
  `is_deleted` tinyint(1) NOT NULL DEFAULT '0',
  `branch_identity_id` varchar(32) DEFAULT NULL,
  `date_of_birth` date DEFAULT NULL,
  `preferred_address_id` int(11) DEFAULT NULL,
  `exam_cost` decimal(13,2) DEFAULT NULL,
  `is_auto_renew_on` tinyint(1) NOT NULL DEFAULT '0',
  `lens_type` enum('daily','weekly','monthly') DEFAULT NULL,
  `estimated_reorder_date` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uniq_external_id` (`external_id`,`partner_id`),
  UNIQUE KEY `uniq_email` (`email`,`partner_id`),
  KEY `preferred_address_id` (`preferred_address_id`),
  KEY `partner_id_fk` (`partner_id`),
  CONSTRAINT `partner_id_fk` FOREIGN KEY (`partner_id`) REFERENCES `partners` (`id`),
  CONSTRAINT `users_ibfk_1` FOREIGN KEY (`preferred_address_id`) REFERENCES `addresses` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=8138 DEFAULT CHARSET=utf8;
